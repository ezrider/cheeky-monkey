---

title: Caseload Modelling - Monthly Totals Cases Opened


keywords: fastai
sidebar: home_sidebar



nb_path: "21. Caseload Modelling - Monthly Totals Cases Opened.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 21. Caseload Modelling - Monthly Totals Cases Opened.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Cases classified as 'Ignored Cases' have been removed in this analysis.  </li>
<li>Adjudicated cases have not been removed in order to include this feature in some analysis.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span>  <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>

<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">_</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">data_transformers</span><span class="o">.</span><span class="n">disable_max_rows</span><span class="p">()</span>

<span class="c1">#year_portion_limit = 0.8</span>

<span class="n">debug</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">CESSATION_CONTINUATION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Driver Deceased&#39;</span><span class="p">:</span> <span class="s1">&#39;Deceased&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Drivers found medically unfit to drive&#39;</span><span class="p">:</span><span class="s1">&#39;Cessation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Drivers that did not respond; cancelled license&#39;</span><span class="p">:</span><span class="s1">&#39;Cessation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Drivers that voluntarily surrendered their license&#39;</span><span class="p">:</span><span class="s1">&#39;Cessation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Drivers ultimately found fit to drive&#39;</span><span class="p">:</span><span class="s1">&#39;Continuation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cases remaining open at time of reporting&#39;</span><span class="p">:</span><span class="s1">&#39;Continuation&#39;</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># caseload_data_by_month[&#39;Opened Month&#39;] = caseload_data_by_month.apply(lambda x: x[&#39;CASE_OPENED_DT&#39;].strftime(&#39;%b&#39;) + &#39;-&#39; + x[&#39;CASE_OPENED_DT&#39;].strftime(&#39;%Y&#39;), axis=1)</span>

<span class="n">generated_file_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\mbeaulieu\rsi_project_book\Data\Generated</span><span class="se">\\</span><span class="s1">&#39;</span>

<span class="n">caseload_data_by_month</span> <span class="o">=</span> <span class="n">get_generated_caseload_data_bymonth</span><span class="p">(</span><span class="n">generated_file_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="4-Years-of-case-data---Jan-2018-to-Oct-2021">4 Years of case data - Jan 2018 to Oct 2021<a class="anchor-link" href="#4-Years-of-case-data---Jan-2018-to-Oct-2021"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">aggregation</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;Open Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Open Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>

   <span class="s1">&#39;Total Cases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Open Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">legend_order</span> <span class="o">=</span> <span class="n">caseload_data_by_month</span><span class="p">[</span><span class="s1">&#39;Opened Month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">backlog_data_byday</span> <span class="o">=</span> <span class="n">caseload_data_by_month</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year Span&#39;</span><span class="p">,</span> <span class="s1">&#39;Age Category&#39;</span><span class="p">,</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">,</span><span class="s1">&#39;Opened Month&#39;</span><span class="p">])</span> \
<span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">**</span> <span class="n">aggregation</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">backlog_data_byday</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;sum(Total Cases):Q&quot;</span> <span class="p">),</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;Year Span:T&quot;</span><span class="p">,</span>  <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">),</span>
   <span class="n">color</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;Opened Month:N&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">legend_order</span> <span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CASE_OPENED_DT:T&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
<span class="p">)</span>

<span class="n">montly_backlog_all</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">aggregation</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;Open Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Open Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>

   <span class="s1">&#39;Status Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Status Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">legend_order</span> <span class="o">=</span> <span class="n">caseload_data_by_month</span><span class="p">[</span><span class="s1">&#39;Opened Month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">backlog_data_byday</span> <span class="o">=</span> <span class="n">caseload_data_by_month</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year Span&#39;</span><span class="p">,</span> <span class="s1">&#39;Age Category&#39;</span><span class="p">,</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">,</span><span class="s1">&#39;Opened Month&#39;</span><span class="p">,</span><span class="s1">&#39;Status&#39;</span><span class="p">])</span> \
<span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">**</span> <span class="n">aggregation</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">backlog_data_byday</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="s2">&quot;datum[&#39;Status&#39;] == &#39;Open&#39;&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;sum(Status Count):Q&quot;</span> <span class="p">),</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;Year Span:T&quot;</span><span class="p">,</span>  <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">),</span>
   <span class="n">color</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;Opened Month:N&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">legend_order</span> <span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CASE_OPENED_DT:T&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
<span class="p">)</span>

<span class="n">montly_backlog_all</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># aggregation = {</span>
<span class="c1">#          &#39;Open Count&#39;: (&#39;Open Count&#39;,&#39;sum&#39;),</span>

<span class="c1">#    &#39;Total Cases&#39;: (&#39;Case Count&#39;,&#39;sum&#39;),</span>
<span class="c1"># }</span>

<span class="c1"># row_order = caseload_data_by_month[&#39;Opened Month&#39;].unique()</span>
<span class="c1"># backlog_data_byday = caseload_data_by_month.groupby([&#39;Year Span&#39;, &#39;Age Category&#39;,&#39;CASE_OPENED_DT&#39;,&#39;Opened Month&#39;]) \</span>
<span class="c1"># .agg(** aggregation).reset_index()</span>

<span class="c1"># montly_backlog_all = alt.Chart(backlog_data_byday).mark_bar().encode(</span>
<span class="c1">#     y = alt.Y(&quot;sum(Open Count):Q&quot; ),</span>
<span class="c1">#     x = alt.X(&quot;Year Span:T&quot;,  scale=alt.Scale(zero=False) ),</span>
<span class="c1"># #   color = &quot;CASE_OPENED_DT:N&quot;,</span>
<span class="c1">#     tooltip=[&#39;CASE_OPENED_DT:T&#39;],</span>
<span class="c1">#     row = alt.Row(&#39;Opened Month&#39;,sort=row_order)</span>
<span class="c1"># #    x=alt.X(&#39;Categories&#39;, sort=row_order),</span>
<span class="c1"># ).properties(</span>
<span class="c1">#     width=600,</span>
<span class="c1">#     height=100</span>
<span class="c1"># )</span>

<span class="c1"># montly_backlog_all</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source2</span> <span class="o">=</span> <span class="p">[{</span>
            <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-03-17T00:00:00.000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-08-18T00:00:00.000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="s1">&#39;Covid Shutdown&#39;</span>
          <span class="p">},</span>
          <span class="p">{</span>            
            <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-08-19T00:00:00.000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2021-01-01T00:00:00.000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="s1">&#39;Start up&#39;</span>
          <span class="p">}]</span>


<span class="c1">#source = alt.pd.DataFrame(source)</span>
<span class="n">source2</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">source2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">monthly_team_capacity</span> <span class="o">=</span> <span class="mi">33780</span>

<span class="n">aggregation</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;Open Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Open Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>

   <span class="s1">&#39;Total Cases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Case Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">legend_order</span> <span class="o">=</span> <span class="n">caseload_data_by_month</span><span class="p">[</span><span class="s1">&#39;Opened Month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">backlog_data_byday</span> <span class="o">=</span> <span class="n">caseload_data_by_month</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year Span&#39;</span><span class="p">,</span> <span class="s1">&#39;Age Category&#39;</span><span class="p">,</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">,</span><span class="s1">&#39;Opened Month&#39;</span><span class="p">])</span> \
<span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">**</span> <span class="n">aggregation</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">backlog_data_byday</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="s2">&quot;datum[&#39;Open Count&#39;] &gt; 0&quot;</span>

<span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;sum(Open Count):Q&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Caseload Count&#39;</span><span class="p">)</span> <span class="p">),</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;Year Span:T&quot;</span><span class="p">,</span>  <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">),</span>
   <span class="n">color</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;Opened Month:N&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">legend_order</span> <span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CASE_OPENED_DT:T&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
<span class="p">)</span>

<span class="n">source3</span> <span class="o">=</span> <span class="p">[{</span>
            <span class="s1">&#39;Team Capacity&#39;</span><span class="p">:</span> <span class="n">monthly_team_capacity</span><span class="p">,</span>
            <span class="s1">&#39;tooltip&#39;</span><span class="p">:</span><span class="s1">&#39;Montly Team Capacity&#39;</span>
          <span class="p">}]</span>
<span class="n">source3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">source3</span><span class="p">)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source3</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span>   <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span> <span class="s1">&#39;Team Capacity&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">SizeValue</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Team Capacity&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1"># .transform_filter(</span>
<span class="c1">#     brush</span>
<span class="c1"># )</span>

<span class="n">source2</span> <span class="o">=</span> <span class="p">[{</span>
            <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-03-17T00:00:00.000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-08-18T00:00:00.000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="s1">&#39;Covid Shutdown&#39;</span>
          <span class="p">},</span>
          <span class="p">{</span>            
            <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-08-19T00:00:00.000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2021-01-01T00:00:00.000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="s1">&#39;Post-Covid Start up&#39;</span>
          <span class="p">},</span>
          <span class="p">{</span>            
            <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2021-01-01T00:00:00.000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2021-09-01T00:00:00.000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="s1">&#39;DMER Shutdown&#39;</span>
          <span class="p">}</span>
<span class="p">]</span>


<span class="n">source2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">source2</span><span class="p">)</span>
<span class="n">rect</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source2</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rect</span><span class="p">(</span>
    <span class="n">opacity</span><span class="o">=</span><span class="mf">.2</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;start:T&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">),</span>
    <span class="n">x2</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X2</span><span class="p">(</span><span class="s1">&#39;end:T&#39;</span><span class="p">),</span> <span class="c1"># , axis=alt.Axis(title=&#39;&#39;) ),</span>
<span class="c1">#    color=&#39;event:N&#39;,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;event:N&#39;</span><span class="p">),</span> <span class="c1"># legend=None),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;event:N&#39;</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">rect</span> <span class="o">+</span> <span class="n">montly_backlog_all</span><span class="p">)</span>
<span class="c1"># .resolve_axis(</span>
<span class="c1">#     x=&#39;independent&#39;,</span>
<span class="c1">#     #x2=&#39;independent&#39; #+ line</span>
<span class="c1"># )</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">monthly_team_capacity</span> <span class="o">=</span> <span class="mi">7894</span>

<span class="n">aggregation</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s1">&#39;Open Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Open Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
   <span class="s1">&#39;Total Cases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Case Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
<span class="p">}</span>
<span class="c1">#legend_order = backlogdata_by_month[&#39;Opened Month&#39;].unique()</span>

<span class="n">caseload_data_byday</span> <span class="o">=</span> <span class="n">caseload_data_by_month</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year Span&#39;</span><span class="p">,</span> <span class="s1">&#39;Age Category&#39;</span><span class="p">,</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">,</span><span class="s1">&#39;Opened Month&#39;</span><span class="p">])</span> \
<span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">**</span> <span class="n">aggregation</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">caseload_data_by_month</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="s2">&quot;datum[&#39;Open Count&#39;] &gt; 0&quot;</span>

<span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;sum(Open Count):Q&quot;</span> <span class="p">),</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;Year Span:T&quot;</span><span class="p">,</span>  <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">),</span>
   <span class="n">color</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;Age Category:N&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">legend_order</span> <span class="p">),</span>
<span class="c1">#    tooltip=[&#39;CASE_OPENED_DT:T&#39;]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
<span class="p">)</span>

<span class="n">source3</span> <span class="o">=</span> <span class="p">[{</span>
            <span class="s1">&#39;Team Capacity&#39;</span><span class="p">:</span> <span class="n">monthly_team_capacity</span><span class="p">,</span>
            <span class="s1">&#39;tooltip&#39;</span><span class="p">:</span><span class="s1">&#39;Montly Team Capacity&#39;</span>
          <span class="p">}]</span>
<span class="n">source3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">source3</span><span class="p">)</span>

<span class="n">line</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source3</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span>     <span class="s1">&#39;Team Capacity&#39;</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">SizeValue</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Team Capacity&#39;</span><span class="p">]</span>
<span class="p">)</span>


<span class="c1"># .transform_filter(</span>
<span class="c1">#     brush</span>
<span class="c1"># )</span>

<span class="c1"># source2 = [{</span>
<span class="c1">#             &#39;start&#39;: &#39;2020-03-17T00:00:00.000000000&#39;,</span>
<span class="c1">#             &#39;end&#39;: &#39;2020-08-18T00:00:00.000000000&#39;,</span>
<span class="c1">#             &#39;event&#39;: &#39;Covid Shutdown&#39;</span>
<span class="c1">#           },</span>
<span class="c1">#           {            </span>
<span class="c1">#             &#39;start&#39;: &#39;2020-08-19T00:00:00.000000000&#39;,</span>
<span class="c1">#             &#39;end&#39;: &#39;2021-01-01T00:00:00.000000000&#39;,</span>
<span class="c1">#             &#39;event&#39;: &#39;Post-Covid Start up&#39;</span>
<span class="c1">#           },</span>
<span class="c1">#           {            </span>
<span class="c1">#             &#39;start&#39;: &#39;2021-01-01T00:00:00.000000000&#39;,</span>
<span class="c1">#             &#39;end&#39;: &#39;2021-09-01T00:00:00.000000000&#39;,</span>
<span class="c1">#             &#39;event&#39;: &#39;DMER Shutdown&#39;</span>
<span class="c1">#           }</span>
<span class="c1"># ]</span>


<span class="c1"># source2 = pd.DataFrame(source2)</span>
<span class="c1"># rect = alt.Chart(source2).mark_rect(</span>
<span class="c1">#     opacity=.4</span>
<span class="c1"># ).encode(</span>
<span class="c1">#     x=&#39;start:T&#39;,</span>
<span class="c1">#     x2=&#39;end:T&#39;,</span>
<span class="c1">#     color=&#39;event:N&#39;,</span>
<span class="c1">#     tooltip=&#39;event:N&#39;</span>
<span class="c1"># #    , axis=None</span>
<span class="c1"># )</span>
<span class="n">montly_backlog_all</span> <span class="c1"># +  line</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">monthly_team_capacity</span> <span class="o">=</span> <span class="mi">7894</span>



<span class="n">aggregation</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;Open Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Open Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>

   <span class="s1">&#39;Status Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Status Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">legend_order</span> <span class="o">=</span> <span class="n">caseload_data_by_month</span><span class="p">[</span><span class="s1">&#39;Opened Month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">backlog_data_byday</span> <span class="o">=</span> <span class="n">caseload_data_by_month</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year Span&#39;</span><span class="p">,</span> <span class="s1">&#39;Age Category&#39;</span><span class="p">,</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">,</span><span class="s1">&#39;Opened Month&#39;</span><span class="p">,</span><span class="s1">&#39;Status&#39;</span><span class="p">])</span> \
<span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">**</span> <span class="n">aggregation</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">backlog_data_byday</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="s2">&quot;datum[&#39;Status&#39;] == &#39;Open&#39;&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;sum(Status Count):Q&quot;</span> <span class="p">),</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;Year Span:T&quot;</span><span class="p">,</span>  <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">),</span>
   <span class="n">color</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;Opened Month:N&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">legend_order</span> <span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CASE_OPENED_DT:T&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
<span class="p">)</span>

<span class="n">source3</span> <span class="o">=</span> <span class="p">[{</span>
            <span class="s1">&#39;Team Capacity&#39;</span><span class="p">:</span> <span class="n">monthly_team_capacity</span><span class="p">,</span>
            <span class="s1">&#39;tooltip&#39;</span><span class="p">:</span><span class="s1">&#39;Montly Team Capacity&#39;</span>
          <span class="p">}]</span>
<span class="n">source3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">source3</span><span class="p">)</span>

<span class="n">line</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source3</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span>     <span class="s1">&#39;Team Capacity&#39;</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">SizeValue</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Team Capacity&#39;</span><span class="p">]</span>
<span class="p">)</span>


<span class="n">montly_backlog_all</span> <span class="o">+</span> <span class="n">line</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

