---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "02_core.caseload.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 02_core.caseload.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="This-code-generates-data-for-caseload-analyis">This code generates data for caseload analyis<a class="anchor-link" href="#This-code-generates-data-for-caseload-analyis"> </a></h2><blockquote><p>When a case spans many months, data is created for each month of it's lifespan in order to perform a variety of analysis.  In this particular scenario, we want assess the impact by month and calulate the effort required.</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_generated_caseload_data_bymonth" class="doc_header"><code>get_generated_caseload_data_bymonth</code><a href="https://github.com/ezrider/cheeky_monkey/tree/{branch}/cheeky_monkey/core/caseload.py#L31" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_generated_caseload_data_bymonth</code>(<strong><code>f_path</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_processed_case_data</span><span class="p">(</span><span class="n">f_path</span><span class="p">):</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">f_path</span> <span class="o">+</span> <span class="s1">&#39;cases_processed.csv&#39;</span>
    <span class="n">cases_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;BIRTHDATE&#39;</span><span class="p">,</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">,</span><span class="s1">&#39;PREV_CASE_END_DT&#39;</span><span class="p">,</span><span class="s1">&#39;LAST_STATUS_DATE&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;DRIVERS_LICENSE_NO&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>
    <span class="n">cases_df</span> <span class="o">=</span> <span class="n">cases_df</span><span class="p">[(</span><span class="n">cases_df</span><span class="p">[</span><span class="s1">&#39;Ignore Case&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">]</span>
    <span class="n">cases_df</span><span class="p">[</span><span class="s1">&#39;Age Category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cases_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;Over 80 &#39;</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">age_bucket</span> <span class="o">&gt;=</span> <span class="mi">80</span> <span class="k">else</span> <span class="s1">&#39;Under 80&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cases_df</span><span class="p">[</span><span class="s1">&#39;Type Origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cases_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;CASE_CD&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ORIGIN_CD&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cases_df</span><span class="p">[</span><span class="s1">&#39;Type &amp; Origin Desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cases_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;CASE_DSC&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ORIGIN_DSC&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cases_df</span><span class="p">[</span><span class="s1">&#39;Case Length Over 30 Days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cases_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;case_length_days&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">30</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cases_df</span><span class="p">[</span><span class="s1">&#39;Case Length Over 60 Days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cases_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;case_length_days&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">60</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_file_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\mbeaulieu\rsi_project_book\Data</span><span class="se">\\</span><span class="s1">&#39;</span>
<span class="n">generated_data_file_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\mbeaulieu\rsi_project_book\Data</span><span class="se">\\</span><span class="s1">&#39;</span>
<span class="n">cases_df</span> <span class="o">=</span> <span class="n">get_processed_case_data</span><span class="p">(</span><span class="n">data_file_path</span><span class="p">)</span>

<span class="c1"># cases_df = pd.read_csv(r&#39;..\cases_processed.csv&#39;,parse_dates=[&#39;BIRTHDATE&#39;,&#39;CASE_OPENED_DT&#39;,&#39;PREV_CASE_END_DT&#39;,&#39;LAST_STATUS_DATE&#39;], dtype={&#39;DRIVERS_LICENSE_NO&#39;: str})</span>
<span class="c1"># cases_df = cases_df[cases_df[&#39;Ignore Case&#39;] == 0]</span>
<span class="c1"># cases_df = cases_df[cases_df[&#39;Is Adjudicated&#39;] == &#39;Adjudicated&#39;]</span>
<span class="c1"># cases_df[&#39;GENERAL_STATUS&#39;].value_counts()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># def f(r):</span>
<span class="c1">#     backlog_diff = r[&#39;Backlog Date&#39;] - r[&#39;CASE_OPENED_DT&#39;]</span>
<span class="c1">#     backlog_diff = backlog_diff/np.timedelta64(1,&#39;M&#39;)</span>
<span class="c1">#     last_update_diff = r[&#39;LAST_STATUS_DATE&#39;] - r[&#39;Backlog Date&#39;] # if same month then</span>
<span class="c1">#     last_update_diff = last_update_diff/np.timedelta64(1,&#39;M&#39;)</span>
<span class="c1">#     if backlog_diff &lt; 2:</span>
<span class="c1">#         return 0</span>
<span class="c1">#     elif last_update_diff &lt;= 0 and backlog_diff &lt; 3 :</span>
<span class="c1">#         return 0</span>
<span class="c1">#     elif ( (r[&#39;Backlog Date&#39;].year == r[&#39;LAST_STATUS_DATE&#39;].year ) </span>
<span class="c1">#            and (r[&#39;Backlog Date&#39;].month - r[&#39;LAST_STATUS_DATE&#39;].month == 0 ) </span>
<span class="c1">#            and ( r[&#39;GENERAL_STATUS&#39;] == &#39;Closed&#39;)   </span>
<span class="c1">#            and backlog_diff &gt;= 2        </span>
<span class="c1">#          ):</span>
<span class="c1">#         return -1</span>
<span class="c1">#     elif backlog_diff &gt;= 2:</span>
<span class="c1">#         return 1</span>
<span class="c1">#     else:</span>
<span class="c1">#         return 100</span>

<span class="c1"># def f_isopen(r):</span>
<span class="c1">#     status_diff = r[&#39;LAST_STATUS_DATE&#39;] - r[&#39;CASE_OPENED_DT&#39;]</span>
<span class="c1">#     status_diff = status_diff/np.timedelta64(1,&#39;M&#39;)</span>
<span class="c1">#     year_span_diff = r[&#39;Year Span&#39;] - r[&#39;LAST_STATUS_DATE&#39;] # if same month then</span>
<span class="c1">#     year_span_diff = year_span_diff/np.timedelta64(1,&#39;M&#39;)    </span>
<span class="c1"># #     print(diff)</span>
<span class="c1"># #     print(year_span_diff)</span>
<span class="c1">#     if year_span_diff &lt; 1 :</span>
<span class="c1">#         return &#39;Open&#39;</span>
<span class="c1">#     else:</span>
<span class="c1">#         return &#39;Closed&#39;</span>

    
<span class="k">def</span> <span class="nf">f_caseload_isopen</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    
    <span class="n">year_span_diff</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Year Span&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;LAST_STATUS_DATE&#39;</span><span class="p">]</span> <span class="c1"># if same month then</span>
    <span class="n">year_span_diff</span> <span class="o">=</span> <span class="n">year_span_diff</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>    

    <span class="n">status_diff</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;LAST_STATUS_DATE&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">]</span>
    <span class="n">status_diff</span> <span class="o">=</span> <span class="n">status_diff</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;GENERAL_STATUS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Open&#39;</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;Open&#39;</span>
        <span class="n">open_count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">closed_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">year_span_diff</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;Open&#39;</span>
            <span class="n">open_count</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">closed_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;Closed&#39;</span>
            <span class="n">open_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">closed_count</span> <span class="o">=</span> <span class="mi">1</span>
        
    <span class="k">return</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">open_count</span><span class="p">,</span> <span class="n">closed_count</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">build_range</span><span class="p">():</span>
    <span class="c1">#r = pd.date_range(*(pd.to_datetime([datetime.strptime(&#39;1-1-2018&#39;, &#39;%d-%m-%Y&#39;), datetime.strptime(&#39;1-9-2021&#39;, &#39;%d-%m-%Y&#39;)]) + pd.offsets.MonthEnd()), freq=&#39;M&#39;) </span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;1-1-2018&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;1-11-2021&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span><span class="p">)])</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">()),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">filter_data</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">d</span><span class="p">[(</span><span class="n">d</span><span class="o">.</span><span class="n">opened_year</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="n">d</span><span class="o">.</span><span class="n">opened_month</span> <span class="o">==</span> <span class="n">month</span> <span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">build_monthly_caseload</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">summaryfilename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;_Adjudicated_Summary.csv&#39;</span> <span class="p">)</span> <span class="c1">#Jan_2018_toSept2021.csv</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;LAST_STATUS_DATE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_date</span>

    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year Span&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">])</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">()),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span>
                  <span class="nb">zip</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">]),</span>
                       <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year Date&#39;</span><span class="p">]))]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;Year Span&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="s1">&#39;Open Count&#39;</span><span class="p">,</span> <span class="s1">&#39;Closed Count&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="n">f_caseload_isopen</span>   <span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># we have determined impact for each case, now aggregate numbers so we have the impact for the month of data</span>


    <span class="n">aggregation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Open Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Open Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
    <span class="s1">&#39;Closed Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Closed Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
    <span class="s1">&#39;Case Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DRIVERS_LICENSE_NO&#39;</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Status Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;STATUS_COUNT&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">monthly_counts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">)</span> <span class="p">,</span> 
                                  <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Year Span&#39;</span><span class="p">),</span>
                                  <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">),</span>
                                  <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Age Category&#39;</span><span class="p">),</span>                                   
                                 <span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">**</span> <span class="n">aggregation</span><span class="p">)</span>
    
    <span class="n">monthly_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">monthly_counts</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">monthly_counts</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">summaryfilename</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">monthly_counts</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">generate_caseload_data</span><span class="p">(</span><span class="n">f_path</span><span class="p">):</span>
    <span class="n">caseload_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">build_range</span><span class="p">()</span>
    <span class="c1">#for date in r[:2]:</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="p">:</span> <span class="k">break</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">generated_data_file_path</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%b&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;toNov2021_ADJUDICATEDCASELOAD&#39;</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span> 

        <span class="n">monthly_data</span> <span class="o">=</span> <span class="n">filter_data</span><span class="p">(</span><span class="n">cases_df</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>    

        <span class="n">caseload_month</span> <span class="o">=</span> <span class="n">build_monthly_caseload</span><span class="p">(</span><span class="n">monthly_data</span><span class="p">,</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">filename</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">caseload_month</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">caseload_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">caseload_data</span> <span class="o">=</span> <span class="n">caseload_month</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">caseload_data</span> <span class="o">=</span> <span class="n">caseload_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">caseload_month</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">caseload_data</span>

    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">caseload_data</span> <span class="o">=</span> <span class="n">generate_caseload_data</span><span class="p">()</span>
    <span class="n">caseload_data</span><span class="p">[</span><span class="s1">&#39;Cases_cumsum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">caseload_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">,</span><span class="s1">&#39;Year Span&#39;</span><span class="p">])[</span><span class="s1">&#39;Case Count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">caseload_data</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">caseload_data</span><span class="p">:</span>

    <span class="n">aggregation</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;Open Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Open Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">jan_data</span> <span class="o">=</span> <span class="n">caseload_data</span><span class="p">[</span><span class="n">caseload_data</span><span class="p">[</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2018-01-31&#39;</span><span class="p">]</span>

    <span class="n">backlog_data_byday</span> <span class="o">=</span> <span class="n">jan_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year Span&#39;</span><span class="p">])</span> \
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">**</span> <span class="n">aggregation</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="k">else</span><span class="p">:</span>
    <span class="n">backlog_data_byday</span> <span class="o">=</span> <span class="s1">&#39;Nothing to be done&#39;</span>
<span class="n">backlog_data_byday</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Nothing to be done&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span>  <span class="n">backlog_data_byday</span> <span class="o">!=</span> <span class="s1">&#39;Nothing to be done&#39;</span><span class="p">:</span>
    <span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">backlog_data_byday</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;Open Count:Q&quot;</span> <span class="p">),</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;Year Span:T&quot;</span><span class="p">,</span>  <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">),</span>
    <span class="c1">#   color = &quot;Year Span:N&quot;,</span>
    <span class="c1">#    tooltip=[&#39;Backlog Total&#39;]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">backlog_data_byday</span>

<span class="n">montly_backlog_all</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Nothing to be done&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">backlog_data_byday</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Nothing to be done&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span>  <span class="n">backlog_data_byday</span> <span class="o">!=</span> <span class="s1">&#39;Nothing to be done&#39;</span><span class="p">:</span>
    <span class="n">aggregation</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;Open Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Open Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
    <span class="c1">#     &#39;Cases&#39;: (&#39;Cases&#39;,&#39;sum&#39;),</span>
    <span class="p">}</span>

    <span class="n">backlog_data_byday</span> <span class="o">=</span> <span class="n">jan_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year Span&#39;</span><span class="p">,</span> <span class="s1">&#39;Age Category&#39;</span><span class="p">])</span> \
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">**</span> <span class="n">aggregation</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">backlog_data_byday</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;sum(Open Count):Q&quot;</span> <span class="p">),</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;Year Span:T&quot;</span><span class="p">,</span>  <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">),</span>
       <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;Age Category:N&quot;</span><span class="p">,</span>
       <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sum(Open Count)&#39;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">backlog_data_byday</span>

<span class="n">montly_backlog_all</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Nothing to be done&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_remove-input">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span>  <span class="n">backlog_data_byday</span> <span class="o">!=</span> <span class="s1">&#39;Nothing to be done&#39;</span><span class="p">:</span>
    <span class="n">aggregation</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;Open Count&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Open Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
       <span class="s1">&#39;Total Cases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Case Count&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">backlog_data_byday</span> <span class="o">=</span> <span class="n">jan_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year Span&#39;</span><span class="p">,</span> <span class="s1">&#39;Age Category&#39;</span><span class="p">,</span><span class="s1">&#39;CASE_OPENED_DT&#39;</span><span class="p">])</span> \
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">**</span> <span class="n">aggregation</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">backlog_data_byday</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;sum(Open Count):Q&quot;</span> <span class="p">),</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;Year Span:T&quot;</span><span class="p">,</span>  <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">),</span>
       <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;CASE_OPENED_DT:N&quot;</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CASE_OPENED_DT:T&#39;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">montly_backlog_all</span> <span class="o">=</span> <span class="n">backlog_data_byday</span>

<span class="n">montly_backlog_all</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Nothing to be done&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">caseload_data</span><span class="p">:</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">generated_data_file_path</span> <span class="o">+</span> <span class="s1">&#39;caseloaddata_by_month.csv&#39;</span> 
    <span class="n">caseload_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">montly_backlog_all</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Nothing to be done
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

